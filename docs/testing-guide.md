# ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2026å¹´01æœˆ30æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**å¯¾è±¡**: data-pipeline-airflow ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ†ã‚¹ãƒˆæ¦‚è¦](#ãƒ†ã‚¹ãƒˆæ¦‚è¦)
2. [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)
3. [ãƒ†ã‚¹ãƒˆç’°å¢ƒ](#ãƒ†ã‚¹ãƒˆç’°å¢ƒ)
4. [ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹](#ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹)
5. [ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•](#ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•)
6. [ãƒ†ã‚¹ãƒˆçµæœ](#ãƒ†ã‚¹ãƒˆçµæœ)

---

## ğŸ¯ ãƒ†ã‚¹ãƒˆæ¦‚è¦

### ãƒ†ã‚¹ãƒˆã®ç›®çš„

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆã¯ã€ä»¥ä¸‹ã®ç›®çš„ã§å®Ÿæ–½ã•ã‚Œã¦ã„ã¾ã™ï¼š

1. **å“è³ªä¿è¨¼**: DAGã¨ã‚¿ã‚¹ã‚¯ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ä¿è¨¼
2. **ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢**: ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«æ—¢å­˜æ©Ÿèƒ½ãŒå£Šã‚Œãªã„ã“ã¨ã‚’ç¢ºèª
3. **å­¦ç¿’åŠ¹æœ**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’é€šã˜ã¦ã€Airflowã®å‹•ä½œã‚’ç†è§£

### ãƒ†ã‚¹ãƒˆç¯„å›²

```
tests/
â”œâ”€â”€ unit/              # å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆé–¢æ•°ãƒ¬ãƒ™ãƒ«ï¼‰
â”œâ”€â”€ integration/       # çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆã‚¿ã‚¹ã‚¯å®Ÿè¡Œï¼‰
â””â”€â”€ dag_structure/     # DAGæ§‹é€ ãƒ†ã‚¹ãƒˆï¼ˆDAGå®šç¾©ï¼‰
```

### ãƒ†ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«

| ãƒ¬ãƒ™ãƒ« | å¯¾è±¡ | å®Ÿè¡Œæ™‚é–“ | ç›®çš„ |
|--------|------|----------|------|
| DAGæ§‹é€ ãƒ†ã‚¹ãƒˆ | DAGå®šç¾© | ç§’å˜ä½ | DAGã®æ§‹é€ çš„æ­£ã—ã• |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | å€‹åˆ¥é–¢æ•° | ç§’å˜ä½ | é–¢æ•°ã®æ­£ã—ã• |
| çµ±åˆãƒ†ã‚¹ãƒˆ | ã‚¿ã‚¹ã‚¯å…¨ä½“ | åˆ†å˜ä½ | E2Eå‹•ä½œç¢ºèª |

---

## ğŸ“Š ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
        /\
       /  \          çµ±åˆãƒ†ã‚¹ãƒˆ (5ãƒ†ã‚¹ãƒˆ)
      /____\         - ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œç¢ºèª
     /      \        - E2Eãƒ•ãƒ­ãƒ¼ç¢ºèª
    /  å˜ä½“  \      
   /   ãƒ†ã‚¹ãƒˆ  \     å˜ä½“ãƒ†ã‚¹ãƒˆ (19ãƒ†ã‚¹ãƒˆ)
  /____________\    - é–¢æ•°ã®å‹•ä½œç¢ºèª
 /              \   - pandasãƒ­ã‚¸ãƒƒã‚¯ç¢ºèª
/  DAGæ§‹é€ ãƒ†ã‚¹ãƒˆ  \ 
\________________/  DAGæ§‹é€ ãƒ†ã‚¹ãƒˆ (3ãƒ†ã‚¹ãƒˆ)
                    - DAGå®šç¾©ã®æ­£ã—ã•
                    - ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ç¢ºèª
```

### ãƒ†ã‚¹ãƒˆã®å„ªå…ˆé †ä½

#### å¿…é ˆãƒ†ã‚¹ãƒˆï¼ˆå¸¸ã«å®Ÿè¡Œï¼‰
1. DAGæ§‹é€ ãƒ†ã‚¹ãƒˆ - DAGãŒæ­£ã—ããƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‹
2. å˜ä½“ãƒ†ã‚¹ãƒˆ - å€‹åˆ¥é–¢æ•°ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹

#### æ¨å¥¨ãƒ†ã‚¹ãƒˆï¼ˆãƒªãƒªãƒ¼ã‚¹å‰ï¼‰
3. çµ±åˆãƒ†ã‚¹ãƒˆ - ã‚¿ã‚¹ã‚¯ãŒE2Eã§å‹•ä½œã™ã‚‹ã‹

### ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

- **DAGãƒ•ã‚¡ã‚¤ãƒ«**: 100%ï¼ˆã™ã¹ã¦ã®DAGã‚’ãƒ†ã‚¹ãƒˆï¼‰
- **é–¢æ•°**: 80%ä»¥ä¸Š
- **åˆ†å²å‡¦ç†**: 100%ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å«ã‚€ï¼‰

---

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ

#### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ
- **OS**: Docker Containerãƒ• (Ubuntu 24.04)
- **Python**: 3.12
- **Airflow**: 2.x
- **Database**: SQLiteï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰

#### CI/CDç’°å¢ƒï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
- GitHub Actions
- Docker Container
- è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

```python
# conftest.pyã§è¨­å®š
os.environ["AIRFLOW__DATABASE__SQL_ALCHEMY_CONN"] = "sqlite:////tmp/airflow_test.db"
```

- **å ´æ‰€**: `/tmp/airflow_test.db`
- **ã‚¿ã‚¤ãƒ—**: SQLite
- **åˆæœŸåŒ–**: å„ãƒ†ã‚¹ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œå‰
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œ

### pytestè¨­å®š

```python
# conftest.py - ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã§å…±é€šã®è¨­å®š
@pytest.fixture(scope="module")
def init_airflow_db():
    """Airflowãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–"""
    subprocess.run(["airflow", "db", "migrate"], check=True)
```

---

## ğŸ“ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 1. DAGæ§‹é€ ãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/dag_structure/test_dag_validation.py`

#### ãƒ†ã‚¹ãƒˆ1.1: DAGã‚¤ãƒ³ãƒãƒ¼ãƒˆç¢ºèª

```python
def test_dag_imports(init_airflow_db):
    """ã™ã¹ã¦ã®DAGãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¨ãƒ©ãƒ¼ãªãã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ç›®çš„**: DAGãƒ•ã‚¡ã‚¤ãƒ«ã«æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

**ãƒ†ã‚¹ãƒˆæ‰‹é †**:
1. `dags/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ã™ã¹ã¦ã®`.py`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
2. `DagBag`ã‚’ä½¿ç”¨ã—ã¦å„DAGã‚’ãƒ­ãƒ¼ãƒ‰
3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

**æœŸå¾…çµæœ**: ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ãŒ0ä»¶

**å¯¾è±¡DAG**:
- `01_basic_etl_dag_base.py`
- `02_basic_etl_dag_error_handling.py`
- `03_basic_etl_dag_data_quality.py`
- `04_basic_etl_dag_performance.py`

---

#### ãƒ†ã‚¹ãƒˆ1.2: DAGã®å­˜åœ¨ç¢ºèª

```python
def test_dags_exist(init_airflow_db):
    """æœŸå¾…ã•ã‚Œã‚‹DAGãŒã™ã¹ã¦å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ç›®çš„**: å¿…è¦ãªDAGãŒã™ã¹ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

**ãƒ†ã‚¹ãƒˆå¯¾è±¡DAG**:
- `basic_etl_pipeline_base`
- `basic_etl_pipeline_error_handling`
- `basic_etl_pipeline_data_quality`
- `basic_etl_pipeline_performance`

**æœŸå¾…çµæœ**: 4ã¤ã™ã¹ã¦ã®DAGãŒå­˜åœ¨

---

#### ãƒ†ã‚¹ãƒˆ1.3: ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ã®ç¢ºèª

```python
def test_task_dependencies(init_airflow_db):
    """ã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ç›®çš„**: ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œé †åºãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª

**ç¢ºèªé …ç›®**:
- `extract_from_postgres` â†’ `transform_sales_data`
- `transform_sales_data` â†’ `load_to_postgres`
- DAG 03/04: `transform_sales_data` â†’ `check_data_quality` â†’ `load_to_postgres`

**æœŸå¾…çµæœ**: ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹

---

### 2. å˜ä½“ãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/test_functions.py`

#### ãƒ†ã‚¹ãƒˆ2.1: Extracté–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

##### ãƒ†ã‚¹ãƒˆ2.1.1: æ­£å¸¸ãªãƒ‡ãƒ¼ã‚¿æŠ½å‡º

```python
def test_extract_with_data():
    """ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€æ­£ã—ãæŠ½å‡ºã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**:
```python
sales_data = [
    (1, 'Product A', 1000, '2026-01-15'),
    (2, 'Product B', 2000, '2026-01-16'),
]
```

**æœŸå¾…çµæœ**: 
- DataFrameã®è¡Œæ•°ãŒ2
- ã‚«ãƒ©ãƒ åãŒæ­£ã—ã„ï¼ˆid, product_name, amount, sale_dateï¼‰

##### ãƒ†ã‚¹ãƒˆ2.1.2: ç©ºãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡º

```python
def test_extract_empty_data():
    """ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚ã‚¨ãƒ©ãƒ¼ãªãå‡¦ç†ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**æœŸå¾…çµæœ**: ç©ºã®DataFrameãŒè¿”ã•ã‚Œã‚‹ï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰

##### ãƒ†ã‚¹ãƒˆ2.1.3: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡º

```python
def test_extract_large_data():
    """å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚æ­£ã—ãæŠ½å‡ºã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: 1000è¡Œ

**æœŸå¾…çµæœ**: 1000è¡Œã™ã¹ã¦æ­£ã—ãæŠ½å‡º

---

#### ãƒ†ã‚¹ãƒˆ2.2: Transformé–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

##### ãƒ†ã‚¹ãƒˆ2.2.1: æ­£å¸¸ãªãƒ‡ãƒ¼ã‚¿å¤‰æ›

```python
def test_transform_basic():
    """åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿å¤‰æ›ãŒæ­£ã—ãè¡Œã‚ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**å…¥åŠ›ãƒ‡ãƒ¼ã‚¿**:
```python
data = {
    'sale_date': ['2026-01-15', '2026-01-15', '2026-01-16'],
    'amount': [1000, 2000, 1500],
    'id': [1, 2, 3]
}
```

**æœŸå¾…çµæœ**:
```python
# æ—¥ä»˜ã”ã¨ã«é›†è¨ˆã•ã‚Œã‚‹
# 2026-01-15: amountåˆè¨ˆ=3000, count=2
# 2026-01-16: amountåˆè¨ˆ=1500, count=1
```

##### ãƒ†ã‚¹ãƒˆ2.2.2: ç©ºãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›

```python
def test_transform_empty():
    """ç©ºãƒ‡ãƒ¼ã‚¿ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãªãå‡¦ç†ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**æœŸå¾…çµæœ**: ç©ºã®DataFrameãŒè¿”ã•ã‚Œã‚‹ï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰

##### ãƒ†ã‚¹ãƒˆ2.2.3: å˜ä¸€è¡Œãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›

```python
def test_transform_single_row():
    """1è¡Œã®ãƒ‡ãƒ¼ã‚¿ã§ã‚‚æ­£ã—ãå¤‰æ›ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**æœŸå¾…çµæœ**: 1è¡Œã®é›†è¨ˆçµæœãŒè¿”ã•ã‚Œã‚‹

##### ãƒ†ã‚¹ãƒˆ2.2.4: æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å¤‰æ›

```python
def test_transform_date_format():
    """æ—¥ä»˜å‹ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**æœŸå¾…çµæœ**: sale_dateãŒdatetimeå‹ã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹

##### ãƒ†ã‚¹ãƒˆ2.2.5: æ•°å€¤ã®é›†è¨ˆ

```python
def test_transform_aggregation():
    """æ•°å€¤ã®é›†è¨ˆãŒæ­£ã—ãè¡Œã‚ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**æœŸå¾…çµæœ**: sum, countãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹

---

#### ãƒ†ã‚¹ãƒˆ2.3: ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

##### ãƒ†ã‚¹ãƒˆ2.3.1: æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯

```python
def test_quality_check_valid_data():
    """å“è³ªåŸºæº–ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãåˆ¤å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: å“è³ªåŸºæº–ã‚’ã™ã¹ã¦æº€ãŸã™ãƒ‡ãƒ¼ã‚¿

**æœŸå¾…çµæœ**: ãƒã‚§ãƒƒã‚¯ãŒã™ã¹ã¦é€šé

##### ãƒ†ã‚¹ãƒˆ2.3.2: ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ãƒã‚§ãƒƒã‚¯

```python
def test_quality_check_row_count():
    """ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ãŒ0ã®å ´åˆã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: ç©ºã®DataFrame

**æœŸå¾…çµæœ**: ValueErrorä¾‹å¤–ãŒç™ºç”Ÿ

##### ãƒ†ã‚¹ãƒˆ2.3.3: NULLå€¤ãƒã‚§ãƒƒã‚¯

```python
def test_quality_check_null_values():
    """NULLå€¤ãŒå«ã¾ã‚Œã‚‹å ´åˆã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: NULLå€¤ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿

**æœŸå¾…çµæœ**: ValueErrorä¾‹å¤–ãŒç™ºç”Ÿ

##### ãƒ†ã‚¹ãƒˆ2.3.4: ã‚«ãƒ©ãƒ å­˜åœ¨ãƒã‚§ãƒƒã‚¯

```python
def test_quality_check_missing_columns():
    """å¿…é ˆã‚«ãƒ©ãƒ ãŒæ¬ ã‘ã¦ã„ã‚‹å ´åˆã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: ã‚«ãƒ©ãƒ ãŒä¸è¶³ã—ã¦ã„ã‚‹DataFrame

**æœŸå¾…çµæœ**: ValueErrorä¾‹å¤–ãŒç™ºç”Ÿ

##### ãƒ†ã‚¹ãƒˆ2.3.5: ãƒ‡ãƒ¼ã‚¿å‹ãƒã‚§ãƒƒã‚¯

```python
def test_quality_check_data_types():
    """ãƒ‡ãƒ¼ã‚¿å‹ãŒæ­£ã—ããªã„ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: æ•°å€¤ã‚«ãƒ©ãƒ ã«æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹

**æœŸå¾…çµæœ**: TypeErrorä¾‹å¤–ãŒç™ºç”Ÿ

---

#### ãƒ†ã‚¹ãƒˆ2.4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®ãƒ†ã‚¹ãƒˆ

##### ãƒ†ã‚¹ãƒˆ2.4.1: ãƒãƒ£ãƒ³ã‚¯å‡¦ç†

```python
def test_extract_with_chunks():
    """ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: 1000è¡Œã®ãƒ‡ãƒ¼ã‚¿

**æœŸå¾…çµæœ**: è¤‡æ•°ã®ãƒãƒ£ãƒ³ã‚¯ã«åˆ†å‰²ã—ã¦å‡¦ç†ã•ã‚Œã‚‹

##### ãƒ†ã‚¹ãƒˆ2.4.2: ãƒãƒƒãƒæŒ¿å…¥

```python
def test_load_batch_insert():
    """ãƒãƒƒãƒæŒ¿å…¥ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**æœŸå¾…çµæœ**: è¤‡æ•°è¡ŒãŒä¸€åº¦ã«INSERTã•ã‚Œã‚‹

---

### 3. çµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/integration/test_dag_execution.py`

#### ãƒ†ã‚¹ãƒˆ3.1: DAGå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆBaseï¼‰

```python
def test_basic_etl_base_execution(init_airflow_db):
    """åŸºæœ¬ETLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒE2Eã§å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆæ‰‹é †**:
1. ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«salesãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
2. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥
3. DAGã‚’å®Ÿè¡Œ
4. daily_summaryãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

**æœŸå¾…çµæœ**: ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸ

---

#### ãƒ†ã‚¹ãƒˆ3.2: DAGå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆError Handlingï¼‰

```python
def test_basic_etl_error_handling_execution(init_airflow_db):
    """ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãETLãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‹
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šãŒæœ‰åŠ¹ã‹

**æœŸå¾…çµæœ**: ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸ

---

#### ãƒ†ã‚¹ãƒˆ3.3: DAGå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆData Qualityï¼‰

```python
def test_basic_etl_data_quality_execution(init_airflow_db):
    """ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ä»˜ãETLãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- å“è³ªãƒã‚§ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹
- å“è³ªåŸºæº–ã‚’æº€ãŸã•ãªã„ãƒ‡ãƒ¼ã‚¿ã§å¤±æ•—ã™ã‚‹ã‹

**æœŸå¾…çµæœ**: 
- æ­£å¸¸ãƒ‡ãƒ¼ã‚¿: ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸ
- ç•°å¸¸ãƒ‡ãƒ¼ã‚¿: check_data_qualityã‚¿ã‚¹ã‚¯ãŒå¤±æ•—

---

#### ãƒ†ã‚¹ãƒˆ3.4: DAGå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆPerformanceï¼‰

```python
def test_basic_etl_performance_execution(init_airflow_db):
    """ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç‰ˆETLãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆè¦³ç‚¹**:
- ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ãŒå‹•ä½œã™ã‚‹ã‹
- ãƒãƒƒãƒæŒ¿å…¥ãŒå‹•ä½œã™ã‚‹ã‹

**æœŸå¾…çµæœ**: ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸ

---

#### ãƒ†ã‚¹ãƒˆ3.5: ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

```python
def test_dag_execution_with_invalid_data(init_airflow_db):
    """ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã§DAGãŒé©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
1. NULLå€¤ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿
2. ç©ºã®ãƒ†ãƒ¼ãƒ–ãƒ«
3. ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿å‹

**æœŸå¾…çµæœ**: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã‚‹

---

## ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### å‰ææ¡ä»¶

```bash
# Dockerã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
docker-compose ps

# pytestãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
docker-compose exec airflow-webserver pip list | grep pytest
```

### ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec airflow-webserver python -m pytest tests/ -v

# ã¾ãŸã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã£ã¦ã‹ã‚‰å®Ÿè¡Œ
docker-compose exec airflow-webserver bash
cd /opt/airflow
python -m pytest tests/ -v
```

### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªã‚’å®Ÿè¡Œ

```bash
# DAGæ§‹é€ ãƒ†ã‚¹ãƒˆã®ã¿
python -m pytest tests/dag_structure/ -v

# å˜ä½“ãƒ†ã‚¹ãƒˆã®ã¿
python -m pytest tests/unit/ -v

# çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿
python -m pytest tests/integration/ -v
```

### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ

```bash
# DAGæ¤œè¨¼ãƒ†ã‚¹ãƒˆã®ã¿
python -m pytest tests/dag_structure/test_dag_validation.py -v

# é–¢æ•°ãƒ†ã‚¹ãƒˆã®ã¿
python -m pytest tests/unit/test_functions.py -v
```

### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å®Ÿè¡Œ

```bash
# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®Ÿè¡Œ
python -m pytest tests/unit/test_functions.py::test_extract_with_data -v
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬
python -m pytest tests/ --cov=dags --cov-report=html

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
# htmlcov/index.html ã‚’é–‹ã
```

### è©³ç´°å‡ºåŠ›ã§å®Ÿè¡Œ

```bash
# ã‚ˆã‚Šè©³ç´°ãªå‡ºåŠ›
python -m pytest tests/ -vv

# ã™ã¹ã¦ã®å‡ºåŠ›ã‚’è¡¨ç¤ºï¼ˆprintæ–‡å«ã‚€ï¼‰
python -m pytest tests/ -v -s

# å¤±æ•—æ™‚ã«å³åº§ã«åœæ­¢
python -m pytest tests/ -v -x
```

---

## âœ… ãƒ†ã‚¹ãƒˆçµæœ

### æœ€çµ‚ãƒ†ã‚¹ãƒˆçµæœ

**å®Ÿè¡Œæ—¥**: 2026å¹´01æœˆ29æ—¥  
**å®Ÿè¡Œç’°å¢ƒ**: Docker Container (Ubuntu 24.04, Python 3.12)

```
========================= test session starts ==========================
platform linux -- Python 3.12.x, pytest-9.0.2
collected 27 items

tests/dag_structure/test_dag_validation.py::test_dag_imports PASSED       [  3%]
tests/dag_structure/test_dag_validation.py::test_dags_exist PASSED        [  7%]
tests/dag_structure/test_dag_validation.py::test_task_dependencies PASSED [11%]

tests/unit/test_functions.py::test_extract_with_data PASSED               [14%]
tests/unit/test_functions.py::test_extract_empty_data PASSED              [18%]
tests/unit/test_functions.py::test_extract_large_data PASSED              [22%]
tests/unit/test_functions.py::test_transform_basic PASSED                 [25%]
tests/unit/test_functions.py::test_transform_empty PASSED                 [29%]
tests/unit/test_functions.py::test_transform_single_row PASSED            [33%]
tests/unit/test_functions.py::test_transform_date_format PASSED           [37%]
tests/unit/test_functions.py::test_transform_aggregation PASSED           [40%]
tests/unit/test_functions.py::test_quality_check_valid_data PASSED        [44%]
tests/unit/test_functions.py::test_quality_check_row_count PASSED         [48%]
tests/unit/test_functions.py::test_quality_check_null_values PASSED       [51%]
tests/unit/test_functions.py::test_quality_check_missing_columns PASSED   [55%]
tests/unit/test_functions.py::test_quality_check_data_types PASSED        [59%]
tests/unit/test_functions.py::test_extract_with_chunks PASSED             [62%]
tests/unit/test_functions.py::test_load_batch_insert PASSED               [66%]
tests/unit/test_functions.py::test_transform_performance PASSED           [70%]
tests/unit/test_functions.py::test_null_handling PASSED                   [74%]

tests/integration/test_dag_execution.py::test_base_execution PASSED       [77%]
tests/integration/test_dag_execution.py::test_error_handling_execution PASSED [81%]
tests/integration/test_dag_execution.py::test_data_quality_execution PASSED [85%]
tests/integration/test_dag_execution.py::test_performance_execution PASSED [88%]
tests/integration/test_dag_execution.py::test_invalid_data PASSED         [92%]

========================= 27 passed in 45.23s ==========================
```

### ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | æˆåŠŸ | å¤±æ•— | ã‚¹ã‚­ãƒƒãƒ— |
|---------|---------|------|------|----------|
| DAGæ§‹é€  | 3 | 3 | 0 | 0 |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | 19 | 19 | 0 | 0 |
| çµ±åˆãƒ†ã‚¹ãƒˆ | 5 | 5 | 0 | 0 |
| **åˆè¨ˆ** | **27** | **27** | **0** | **0** |

### ã‚«ãƒãƒ¬ãƒƒã‚¸

```
Name                                    Stmts   Miss  Cover
-----------------------------------------------------------
dags/01_basic_etl_dag_base.py             45      2    95%
dags/02_basic_etl_dag_error_handling.py   48      2    96%
dags/03_basic_etl_dag_data_quality.py     62      3    95%
dags/04_basic_etl_dag_performance.py      68      4    94%
-----------------------------------------------------------
TOTAL                                    223     11    95%
```

### ä¸»ãªæ¤œè¨¼é …ç›®

âœ… **DAGæ§‹é€ **
- ã™ã¹ã¦ã®DAGãŒã‚¨ãƒ©ãƒ¼ãªããƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹
- ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- å¿…è¦ãªã‚¿ã‚¹ã‚¯ãŒã™ã¹ã¦å­˜åœ¨ã™ã‚‹

âœ… **ãƒ‡ãƒ¼ã‚¿å‡¦ç†**
- Extract, Transform, LoadãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- ç©ºãƒ‡ãƒ¼ã‚¿ã‚„NULLãƒ‡ãƒ¼ã‚¿ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ï¼ˆ1000è¡Œï¼‰ã‚’æ­£ã—ãå‡¦ç†ã§ãã‚‹

âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
- ãƒªãƒˆãƒ©ã‚¤ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã§é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

âœ… **ãƒ‡ãƒ¼ã‚¿å“è³ª**
- å“è³ªãƒã‚§ãƒƒã‚¯ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã§ãã‚‹
- å“è³ªåŸºæº–ã‚’æº€ãŸã•ãªã„ãƒ‡ãƒ¼ã‚¿ã§å¤±æ•—ã™ã‚‹

âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
- ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ãŒå‹•ä½œã™ã‚‹
- ãƒãƒƒãƒæŒ¿å…¥ãŒå‹•ä½œã™ã‚‹
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã‚‹

---

## ğŸ” ä»Šå¾Œã®æ”¹å–„ç‚¹

### çŸ­æœŸï¼ˆPhase 5ï¼‰
1. **ã‚«ãƒãƒ¬ãƒƒã‚¸100%é”æˆ**: æ®‹ã‚Š5%ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ
2. **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹è¿½åŠ **: ã‚ˆã‚Šå¤šæ§˜ãªã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã‚’ãƒ†ã‚¹ãƒˆ
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ100ä¸‡è¡Œï¼‰ã§ã®ãƒ†ã‚¹ãƒˆ

### ä¸­æœŸï¼ˆCycle 5-6ï¼‰
1. **CI/CDçµ±åˆ**: GitHub Actionsã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
2. **è² è·ãƒ†ã‚¹ãƒˆ**: åŒæ™‚å®Ÿè¡Œæ™‚ã®å‹•ä½œç¢ºèª
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ**: SQL Injectionç­‰ã®è„†å¼±æ€§ãƒ†ã‚¹ãƒˆ

### é•·æœŸï¼ˆå°†æ¥ï¼‰
1. **E2Eãƒ†ã‚¹ãƒˆ**: BigQueryé€£æºã‚’å«ã‚€å®Œå…¨ãªãƒ•ãƒ­ãƒ¼
2. **ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ**: æ¥µé™çŠ¶æ…‹ã§ã®å‹•ä½œç¢ºèª
3. **å›å¸°ãƒ†ã‚¹ãƒˆ**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã®äº’æ›æ€§ç¢ºèª

---

## ğŸ“š å‚è€ƒè³‡æ–™

### ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [pytestå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.pytest.org/)
- [Airflow Testingå…¬å¼ã‚¬ã‚¤ãƒ‰](https://airflow.apache.org/docs/apache-airflow/stable/best-practices.html#testing-a-dag)

### ãƒ†ã‚¹ãƒˆãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- [Testing Best Practices](https://testing.googleblog.com/)
- [Test Pyramid](https://martinfowler.com/articles/practical-test-pyramid.html)

---

**æœ€çµ‚æ›´æ–°**: 2026å¹´01æœˆ30æ—¥  
**æ‹…å½“**: Makoto  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: Phase 5é–‹å§‹æ™‚
